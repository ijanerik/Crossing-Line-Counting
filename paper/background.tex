\chapter{Background}
In this chapter a selection of terms is explained which gives a basis to understand the rest of this thesis. This background is created with the assumption that the reader has a basic background in Machine Learning and (Convolutional) Neural Networks.

\section{Region of Interest}
\todo{Transform to Region of Interest}
Crowd Counting in Machine Learning is a hot topic with a lot of new and recent papers. The goal of Crowd Counting is to count the amount of pedestrians present in a given image. This can be an individual image or a frame of a video sequence. The goal with Crowd Counting is only to give the amount of people in the image. The exact location of each pedestrian is irrelevant for this task. Crowd Counting can be done on a whole image or only given a part of the image. This region is then specified as the Region of Interest.

So the goal is to predict based on the given image the amount of pedestrians in an image. So can we directly predict the amount of pedestrians in the frame using a Machine Learning method? With a direct approach the amount of supervision on the weights is very low, so to train the model correctly, the amount of images required is very high. So all recent State-of-the-Art methods make use of an intermediate representation to give the model enough supervision to perform Crowd Counting with a low amount of training samples.

\subsection{Object Recognition}
A simple solution would be found in Object Recognition, as well a subfield of Machine Learning. This tries to locate objects given an image or video. By counting the amount of found objects in a frame we can predict the amount of pedestrians in a frame. For an area with a low count of pedestrians which are large enough, existing object recognition methods would be sufficient to recognize each pedestrian and give the correct count of the pedestrians in the given region.

So why not use general Object Recognition for Crowd Counting? The accuracy of Object Recognition will quickly degrade when pedestrians get smaller and the amount of pedestrians in the frame will increase. A lot of Object Recognition software has limitations with the total amount of objects it can recognize in a single image (Mostly around 50-100). Additionally they have a hard time when objects get occluded by each other, especially when they are small.
\todo{This should be backedup by real numbers/papers. YOLO check limit and some others, maybe other crowd counting papers}
Therefore most of the benchmarks used in Crowd Counting contain several hundred pedestrians to several thousands pedestrians per frame.
\todo{Show the average pedestrians per benchmark to backup numbers}

\subsection{Density Map}
To the best of our knowledge all of the State-of-the-Art methods currently use a density map as extra supervision representation. A density map for Crowd Counting is a map which represents the density of pedestrians of each pixel. The density map is generated by taking the locations of each pedestrian ($x_p$ and $y_p$ in equation \ref{eq:density_pixel}) and place those locations on the the density map.

Individual dots are very hard for a Neural Network to detect correctly and are proned to errors. To circumvent this a Gaussian shaped circle is crated around this location, still with with a sum of 1. The amount of pedestrians in the frame can be extracted from the density map by taking the sum over all the pixels of the density map (Equation \ref{eq:density_sum}, where $D_i(x,y)$ is the density for location $x,y$ for trainings frame $i$).

\begin{equation}
\label{eq:density_pixel}
	D_i(x,y) = \frac{1}{2 \pi \sigma_p^2}\sum^P_{p=1} e^{\frac{(x_p-x)^2+(y_p-x)^2}{-2 \sigma_p^2}}
\end{equation}

\begin{equation}
	\label{eq:density_sum}
	C_i = \sum_{x=0,y=0}^{X,Y} D_i(x,y)
\end{equation}

Several methods have been presented to optimize the generation of density maps. For most medium dense frames the difference in methods is minimal. Often in benchmarks with medium dense frames a fixed sigma is used ($\sigma_p=\sigma_i$ in equation \ref{eq:density_pixel}). For highly dense frames the use of different methods can have a difference, especially when the difference in size between close pedestrians and pedestrians in the background is large.
\todo{Show image of crowd and of the density map}

\section{Flow Estimation}
The research which is done on the Flow Estimation problem is widely used. Approaches on this topic can be used in a wide range of applications which makes it very interesting. Already in the early 1980's Horn and Schunck \cite{Horn1981} published the first paper which tried to predict flow. Since then lot's of different approaches have been published. Long conventional mathematical approaches have ruled the flow estimation field.

\todo{Maybe explain some extra information about this field and the history}

In 2015 FlowNet was introduced. This supervised network can predict the flow map based on two consecutive frames. The flow map is a map which predict per pixel of the frame the amount of movement to another location. In equation \ref{eq:flow_basis}, $F(x, y)^{(i)}$ shows the flow map as a difference between the location of the pixel in the current frame ($\begin{bmatrix} x \\ y \end{bmatrix}$) and the location of this pixel in the next frame ($L_i(x, y)$).

\begin{equation}
\label{eq:flow_basis}
F_i(x, y) = L_i(x, y) - \begin{bmatrix} x \\ y \end{bmatrix}
\end{equation}

Creating a real world dataset that utilizes the power of pixel-wise flow estimation is very hard. There are no real world devices which could capture both video and create pixel perfect ground-truths to train the flow estimation models on. Most of the flow estimation benchmarks are therefore generated videos. Computer 3D-engines make it possible to generate pixel-perfect flow estimation based on the generated videos in the engine.

With the lack of real world usability several papers introduced methods to learn unsupervised the flow maps.
\todo{Read some more and explain some high level shit :)}

\section{Line of Interest}
Line of Interest is very similar to Region of Interest. Where Region of Interest is the interest of the amount of people inside the ROI, the Line of Interest is the focus on the amount of pedestrians that cross the specified line during a certain timeframe.
\todo{Add an image with a line drawn inside the TUB dataset}

With the Line of Interest problem the goal is to give the amount of pedestrians crossing of each side given a set of frames (a pre-captured video or video stream). The output of the prediction should give two numbers. In the rest of this thesis we refer to these sides as side left-to-right (side L) and right-to-left (side R). This with the assumption that a line is drawn vertically from top to bottom without losing generality.

Only a handful of papers are published about Line of Interest. In the earlier papers \cite{ma_counting_2016, cao_large_2015}, slicing was a widely used approach to estimate the Line of Interest. With slicing a small portion of the given frame around the LOI was taken. Over a set of consecutive frames each slice of the frame was taken and stitched together into a single image. On the images slow walking pedestrians appear rather wide and fast walking pedestrians shallow. By counting the amount of pedestrians present on the stitched image, the total amount of pedestrians crossing the line can be counted.

Recent papers discard this method, because it makes it hard to track pedestrian with different speeds and walking in different directions give artifacts which make it hard to track those pedestrians. In recent papers this method is discarded and actual frame by frame prediction is introduced. Using two consecutive frames the amount of pedestrians crossing the line is measured. These newer methods predict both location and direction of the pedestrian. 
\todo{Maybe a bit more indepth}

Based on these new papers, the problem of Line of Interest is divided into three separate problems. Locating the pedestrians (Region of Interest), estimate the direction (Flow Estimation) of the pedestrians and combining these two streams of information into the count for Line of Interest.